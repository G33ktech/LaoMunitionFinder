<!DOCTYPE html>

<html>
<head> 
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" type="text/css" href="deakin.css"> 
    <title>Contact Us</title>
	<script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyDFgB_ezGiDhyzfozienoYq-Qyu-nF6iWc&sensor=false"> </script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
   
    <script type="text/javascript" src="./resources/markerclusterer_compiled.js">
	</script>
</head> 
    <body>
       <div id="wrapper">
            <header >
                    <h1>Laos War Time Munitions Finder</h1>
                    
			<nav id="container">
               <img id="lao_title" src="lao.png" />
				<ul class="menu">
				<li class="first_tab"><a href="index.html">Home</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="support.html">Support</a></li>
                <li><a href="the_team.html">The Team</a></li>
                <li class="last_tab"><a href="contact_us.html">Contact Us</a></li>
                </ul>

            </nav>
			</header>
           <br />
            <div class="main">


<script type="text/javascript">

	var map;
	var myCenter=new google.maps.LatLng(17.471,105.408);
	var latt = 17.471;
	var lng =  105.408;
	var mapProp;
	var markers = [];
	var infowindow;
	var markerCluster;
	function initialize()
		{
			mapProp = 
			{
				  center:myCenter,
				  zoom:9,
				  mapTypeId:google.maps.MapTypeId.ROADMAP
				  
			};

			map = new google.maps.Map(document.getElementById("googleMap"),mapProp);	  
			var marker;			
			document.getElementById("latt").value = latt;
			document.getElementById("long").value = lng;
			
			infowindow = new google.maps.InfoWindow();
			function placeMarker(location) 
				{
					if ( marker ) 
					{
						marker.setPosition(location);
					} else 
					{
						marker = new google.maps.Marker(
						{
							position: location,
							map: map
						});
					}
					infowindow = new google.maps.InfoWindow(
					{
						content: 'Latitude: ' + location.lat() + '<br>Longitude: ' + location.lng()
					});
					infowindow.open(map,marker);
				}
		}

	function writeData(location)
		{
			latt =location.lat();
			lng = location.lng();
			document.getElementById("latt").value = latt;
			document.getElementById("long").value = lng;
			document.getElementById("getLatt").value = latt;
			document.getElementById("getLong").value = lng;
		}

	function writeTime(time)
		{
			document.getElementById("time").value = time;
		}

	google.maps.event.addDomListener(window, 'load', initialize);
	function placeBomb(location, contentData) 
	{
		
		var marker = new google.maps.Marker(
		{
			position: location,
			map: map
		});
		
		var infowindow = new google.maps.InfoWindow(
		{
			content: contentData
		});
		infowindow.open(map,marker);
	}	
	function showKML()
	{
	  var kmlLayer = new google.maps.KmlLayer({
			url: 'resources/bombData.kml',
			suppressInfoWindows: true,
			map: map
		});
	}
	function getAllMarkers() 
	{

		//Show loading image
		$('#outputtext').html('Loading');
		$.post("deakin/proximity_find.php",
		{
			mapfunction:'all'
		},
		function(data, status)
		{
			
			// Hide loading image
			$('#outputtext').html('Bomb Data Loaded');
			clearMarkers();
			//var responsexml = $(data).find('description').first().text();
			//$('#xmltext').html($(data).text());
			$(data).find('sortie').each(function(index){
				var lat = $(this).find('lat').text();
				var lng = $(this).find('long').text();
				var latLng = new google.maps.LatLng(lat,lng,false);
				var contentData =  'Ordnance = ' +  $(this).find('ordnance').text() + '<br/> BDA = ' + $(this).find('bda').first().text();
				var icon;
				switch ($(this).find('target').text())
				{
					case 'Road':
						icon = 'blue';
						break;
					case 'FOSD':
						icon = 'green';
						break;
					default:
						icon = 'red';
					
				}
				icon = "http://maps.google.com/mapfiles/ms/icons/" + icon + ".png";
				var marker = new google.maps.Marker({
					position: latLng,
					map: map,
					icon: new google.maps.MarkerImage(icon)
				});
				google.maps.event.addListener(marker, 'click', (function(marker, contentData) {
					return function() {
						infowindow.setContent(contentData);
						infowindow.open(map, marker);
					}
				})(marker, contentData));
				markers.push(marker);
				//placeBomb(position,contentData);
			});
			
		});
	}
	function getWindowMarkers() 
	{

		//Show loading image
		$('#outputtext').html('Loading');
		clearMarkers();
		var bounds = map.getBounds();
		alert( bounds.getSouthWest().lat() + ', ' + 
			bounds.getSouthWest().lng() + ', ' +
			bounds.getNorthEast().lat() + ', ' +
			bounds.getNorthEast().lng());
		$.post("deakin/proximity_find.php",
		{
			mapfunction:'window',
			swlat:bounds.getSouthWest().lat(),
			swlong:bounds.getSouthWest().lng(),
			nelat:bounds.getNorthEast().lat(),
			nelong:bounds.getNorthEast().lng()
		},
		function(data, status)
		{
			
			// Hide loading image
			$('#outputtext').html($(data).text());
			
			//var responsexml = $(data).find('description').first().text();
			//$('#xmltext').html($(data).text());
			$(data).find('sortie').each(function(index){
				
				var lat = $(this).find('lat').text();
				var lng = $(this).find('long').text();
				var latLng = new google.maps.LatLng(lat,lng,false);
				if (bounds.contains(latLng))
				{
					var contentData =  'Ordnance = ' +  $(this).find('ordnance').text() + '<br/> BDA = ' + $(this).find('bda').first().text();
					var icon;
					switch ($(this).find('target').text())
					{
						case 'Road':
							icon = 'blue';
							break;
						case 'Building':
							icon = 'green';
							break;
						default:
							icon = 'red';
							
					}
					icon = "http://maps.google.com/mapfiles/ms/icons/" + icon + ".png";
					var marker = new google.maps.Marker({
						position: latLng,
						map: map,
						icon: new google.maps.MarkerImage(icon)
					});
					google.maps.event.addListener(marker, 'click', (function(marker, contentData) {
						return function() {
							infowindow.setContent(contentData);
							infowindow.open(map, marker);
						}
					})(marker, contentData));
					markers.push(marker);
				}
				//placeBomb(position,contentData);
			});
			markerCluster = new MarkerClusterer(map, markers);
			$('#clustertext').html(markerCluster.getTotalClusters());
		});
	}
	// Sets the map on all markers in the array.
	function setAllMap(map) {
		for (var i = 0; i < markers.length; i++) {
			markers[i].setMap(map);
		}
	}
	function clearMarkers()
	{
		setAllMap(null);
		markers = [];
	}
function getxml() {
	$.post("http://databackformserver.com.au/deakin/proximity_find.php",
    {
		latt:latt,
		longa:lng,
		dataType:cluster,
		dataform:xml,		
    },
    function(data, status){
        alert(data +" "+ status);
    });
}	
</script>


<!-------------------Container for map element----------------->	
	<div id="leftColumn" style="float:left;width:600px;height:420px;">
		<div id="googleMap" style="width:590px;height:380px;">
		</div>
		<form id="login" action = "http://databackformserver.com.au/deakin/proximity_find_2.php" method = "post">
			<input type = "hidden" name = "latt" id = "latt"  />
			<input type = "hidden" name = "long" id = "long"  />
			<input type = "submit" name = "Submit" value = "Get Data" />
		</form>
		<button id="buttonWindowMarkers" name = "buttonWindowMarkers" onclick="getWindowMarkers()"> Show bombs in map </button>
		<button id="buttonClearMarkers" name = "buttonClearMarkers" onclick="clearMarkers()"> Clear all markers </button>
		<button id="buttonXML" name = "buttonXML" onclick="getKML()">Get KML</button>
		<div class = "outputtext" id = "outputtext"></div>
		<div class = "clustertext" id = "clustertext"></div>
		<div class= "xmltext" id = "xmltext"></div>
</div>
</div>

      <footer id="footer">
            <div class="footer_img">
                        <a href="https://www.deakin.edu.au" ><img src="deakinv2.jpg" alt="DEAKIN" /></a>
                
                <p class="footer1">Designed by - SIT782 Group 14 T1 2015</p>
                <p class="footer2">This Web Site is for educational purposes only.<br /> 
                Opinions expressed within this Web Site are not necessarily the views of Deakin University Australia.</p>
            </div>
        </footer>
       
     </div>
     </div>
    </body>
    </html>